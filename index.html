<!-- 
    features
- Automatic style adaptation based on image dimensions
- Proportional division of an image into blocks
- Building / exporting HTML file with the game
- Moving multiple blocks in one move
- Drag and Drop upload image 
Contact support support@wiregamer.live
-->




<!DOCTYPE html>
<html>
<head>
<title>wiregamer puzzle maker</title>
<link rel="icon" href="game Puzzel.png" type="game icon">
<meta content="#c4cebb" name="theme-color" charset="UTF-8">
<meta name="description" content="A  of the classic mini-game wiregamer Sliding Puzzle, using HTML5 DOM document elements and without using Canvas or third party libraries.">
<meta name="keywords" content="15Puzzle, js, Open Source, HTML5, Sliding, web, base">
<meta name="author" content="wiregamer.live">
<link rel="stylesheet" href="style.css">
</head>



<body>
   
<div id='wiregamer' ></div> 
<div id="won"  ></div>

<!--element "wiregamer" in which the game will take place-->
<div style='position:fixed;top: 50px;;left: 12px;box-shadow:0px 2px 24px rgba(122, 89, 240, 0.25);border-radius:16px;background-color:#ffffffc2;width:200px;'>
    <td><img src="Wiregamer.live.gif" alt="gif wiregamer"></td>
  
    <div style="display:none;position:fixed;"><img id="art" src=""/><a id="dwonload"></a>
    <!-- <input id="img_file" type="file" accept="image/png,image/gif,image/jpeg,image/webp"/> -->
     <input id="img_file" type="file" accept="image/png,image/gif,image/jpeg,image/webp" onchange="loadFiles(event)">
    </div>
   
    <div style="overflow:auto;width:180px;max-height:100vh;height:100%;padding:8px;">
        <table style="border-collapse:collapse;" border="1">
        <tbody>
        <tr>
        </tr>
        <tr>
        <td style="height:48px;" colspan="2"><div class="button" onclick="img_file.click();">Load img file</div></td>
        </tr>
        <tr>
        <td style="width:68px;height:34px;padding-right:8px;" align="right">Difficulty</td>
        <td><input onchange="setup.puzzle_wiregamer.diff=this.value;wiregamer_update();" value="200" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Width</td>
        <td><input id="width" onchange="setup.puzzle_wiregamer.size[0]=parseInt(this.value);wiregamer_update();" value="1024" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Height</td>
        <td><input id="height" onchange="setup.puzzle_wiregamer.size[1]=parseInt(this.value);wiregamer_update();" value="1281" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Image fill</td>
        <td align="center"><label class="switch">
            <input type="checkbox" onchange="setup.puzzle_wiregamer.art.ratio=this.checked;wiregamer_update();">
            <span class="slider round"></span>
        </label></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Grid width</td>
        <td><input id="grid_width" onchange="setup.puzzle_wiregamer.grid[0]=parseInt(this.value);wiregamer_update();" value="3" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Grid height</td>
        <td><input id="grid_height" onchange="setup.puzzle_wiregamer.grid[1]=parseInt(this.value);wiregamer_update();" value="4" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Move time</td>
        <td ><input onchange="setup.puzzle_wiregamer.time=this.value;wiregamer_update();" value="0.4" class="input_text" type="text"></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Numbers</td>
        <td align="center"><label class="switch">
            <input type="checkbox" onchange="setup.puzzle_wiregamer.number=this.checked;wiregamer_update();">
            <span class="slider round"></span>
        </label></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Puzzle fill</td>
        <td align="center"><label class="switch">
            <input type="checkbox" onchange="setup.puzzle_wiregamer.fill=this.checked;if(!this.checked){window.removeEventListener('resize',wiregamer_resize,true);f.style.transform='scale(1)'};wiregamer_update();" checked>
            <span class="slider round"></span>
        </label></td>
        </tr>
        <tr>
        <td style="height:34px;padding-right:8px;" align="right">Style blocks</td>
        <td><input id="slot_style" onchange="setup.puzzle_wiregamer.style=this.value;wiregamer_update();" class="input_text" type="text"></td>
        </tr>
       
        <tr>
        <td style="height:48px;" colspan="2"><div class="button" onclick="wiregamer_update();">Refresh</div></td>
        </tr>
        <tr>
        <td style="height:48px;" colspan="2"><div class="button" onclick="wiregamer_build();">Create HTML game</div></td>
        </tr>
        <tr><td style="height:16px;" colspan="2"></td></tr>
        
        </tbody>
        </table>
    </div>
</div>
<script>
var setup={
     puzzle_wiregamer:{
        diff:300, // number of movements of the slots for shuffling pictures
        size:[512,640], // element size "wiregamer" in pixels only
        grid:[3,4], // the number of squares in the height and width of the picture
        fill:true, // Stretching the area with the game to fit the element is recommended for fullscreen
        number:false, // Slot sequence number
        art:{
            url:"sheeraz.jpg", // path to the picture (you can use any format of supported browsers, gif-animation of svg)
            ratio:false // enlarge the picture in height or width
        },
        // optional elements
        keyBoard:true, // Control using the keys on the keyboard
        gamePad:true, // Control using the joystick on the Gamepad
        time:0.1, // block move animation time
        style:"background-color:#c4cebb;display:grid;justify-items:center;align-items:center;font-family:Arial;color:#fff;border-radius:12px;font-size:32px;" // style for puzzle square
     }
}

function loadFiles(event) {
    var input = event.target;
    var file = input.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function() {
            var img = document.getElementById("art");
            img.src = reader.result;
            setup.puzzle_wiregamer.art.url = reader.result;
            img.onload = function() {
                setup.puzzle_wiregamer.size = [img.width, img.height];
                auto_grid();
                auto_style();
                wiregamer_update();
            };
        };
        reader.readAsDataURL(file);
    }
}



slot_style.value=setup.puzzle_wiregamer.style;
var img_file=document.getElementById('img_file'),img=document.getElementById("art"),file;
img_file.addEventListener('change',loadFiles);
function loadFiles(e){
    file=img_file.files[0];
    adden_file();
}
function adden_file(){
    setup.puzzle_wiregamer.art.url=window.URL.createObjectURL(file)
    img.src=setup.puzzle_wiregamer.art.url;
    img.onload=function(){setup.puzzle_wiregamer.size=[img.width,img.height];auto_grid();auto_style();wiregamer_update();}
}
function auto_grid(){
    var s=setup.puzzle_wiregamer
    if(s.size[1]<s.size[0]){s.grid=[Math.round(s.size[0]/(s.size[1]/4))-1,3]}
    else{s.grid=[3,Math.round(s.size[1]/(s.size[0]/4))-1]}
    grid_width.value=s.grid[0];
    grid_height.value=s.grid[1];
    width.value=s.size[0];
    height.value=s.size[1];
}
function auto_style(){
    var s=setup.puzzle_wiregamer,v,i;
    if(s.size[1]<s.size[0]){v=Math.round((s.size[0]/s.grid[0])/16)}
    else{v=Math.round((s.size[1]/s.grid[1])/16)}
    d=s.style.split(";");
    for(i=0;i<d.length;i++){
        if(d[i].includes("border-radius")){s.style=s.style.replace(d[i],"border-radius:"+Math.round(v*1.5)+"px")}
        else if(d[i].includes("font-size")){s.style=s.style.replace(d[i],"font-size:"+(v*3)+"px")}
    }slot_style.value=s.style;
}
function wiregamer_update(){
    f.innerHTML="";
    ceation_slots();
}
function wiregamer_build(){
    var reader=new FileReader();
    if(file){reader.readAsDataURL(file);}else{alert('Please upload a file with a picture')}
    reader.onload=function(){setup.puzzle_wiregamer.art.url=reader.result;gen_file();}
    reader.onerror=function(error){alert('Error: '+error);}
    function gen_file(){
        var url="puzzle.js";
        var xmlhttp=new XMLHttpRequest();
        xmlhttp.onreadystatechange=function(){
            if(this.readyState==4&&this.status==200){
                var html="data:text/json;charset=utf-8,"+encodeURIComponent("<!DOCTYPE html>\n<html>\n<head>\n<style>\n body{height:97vh;padding:0;display:grid;align-content:center;justify-content:center;}\n</style>\n</head>\n<body>\n<div id='wiregamer'></div>\n<script>\n"+this.responseText.replace("setup.puzzle_wiregamer",JSON.stringify(setup.puzzle_wiregamer,null,'\t'))+"\n<\/script>\n<\/body>\n<\/html>");
                var a=document.getElementById('dwonload');
                a.setAttribute("href", html );
                a.setAttribute("download","index.html");
                a.click();
            }
        };
        xmlhttp.open("GET",url,true);
        xmlhttp.send();
        xmlhttp.onerror=function(){if(this.status==0){alert('runetime not loaded');}}
    }
}
var drop = {
    init:function(){
        if (window.File&&window.FileReader&&window.FileList&&window.Blob) {
            window.addEventListener("dragover",function(e){
                e.preventDefault();
                e.stopPropagation();
            });
            window.addEventListener("drop",function(e){
                e.preventDefault();
                e.stopPropagation();
                file=e.dataTransfer.files[0];
                adden_file();
            });
        }
    },
};
window.addEventListener("DOMContentLoaded", drop.init);
</script>
<script src="puzzle.js"></script> <!--path to file engine-->
</body>
</html>
